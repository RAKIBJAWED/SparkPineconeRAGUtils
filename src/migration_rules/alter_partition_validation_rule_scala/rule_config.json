{
  "rule_id": "alter_partition_validation_scala_006",
  "rule_name": "ALTER PARTITION Type Validation Migration (Scala)",
  "source_spark_version": "3.3",
  "target_spark_version": "3.4",
  "language": "scala",
  "error_with_before_script": "[CAST_INVALID_INPUT] The value 'invalid_year' of the type \"STRING\" cannot be cast to \"INT\" because it is malformed. Correct the value as per the syntax, or change its target type. Use `try_cast` to tolerate malformed input and return NULL instead. If necessary set \"spark.sql.ansi.enabled\" to \"false\" to bypass this error.",
  "spark_rule": "Since Spark 3.4, Spark will do validation for partition spec in ALTER PARTITION to follow the behavior of spark.sql.storeAssignmentPolicy which may cause an exception if type conversion fails, e.g. ALTER TABLE .. ADD PARTITION(p='a') if column p is int type. To restore the legacy behavior, set spark.sql.legacy.skipTypeValidationOnAlterPartition to true.",
  "spark_doc_link": "https://spark.apache.org/docs/latest/sql-migration-guide.html#upgrading-from-spark-sql-33-to-34",
  "migration_type": "partition_validation_change",
  "severity": "high",
  "category": "partition_management",
  "tags": ["alter_partition", "type_validation", "partition_spec", "sql_ddl", "configuration", "scala"],
  "created_at": "2026-01-07T17:40:00Z"
}